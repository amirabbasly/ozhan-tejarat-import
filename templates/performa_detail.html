<!-- templates/performa_details.html -->

{% extends 'base.html' %}
{% load static %}
{% block title %}جزئیات پروفرما - {{ performa.prf_number }}{% endblock %}

{% block content %}
    <a href="{% url 'performa_list' %}" class="btn btn-secondary mb-3">بازگشت به لیست پروفرماها</a>
    <h1 class="mb-4">جزئیات پروفرما</h1>
    <h2 class="mb-4">{{ performa.prf_number }}</h2>

    <!-- Display Messages -->
    {% if messages %}
      <div class="alert alert-info">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            اطلاعات اصلی
        </div>
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3">تاریخ پروفرما:</dt>
                <dd class="col-sm-9">{{ performa.prf_date|date:"Y-m-d H:i" }}</dd>

                <dt class="col-sm-3">تاریخ انقضا پروفرما:</dt>
                <dd class="col-sm-9">{{ performa.prf_expire_date|date:"Y-m-d H:i" }}</dd>

                <dt class="col-sm-3">قیمت کل:</dt>
                <dd class="col-sm-9">{{ performa.prf_total_price }}</dd>

                <dt class="col-sm-3">نوع ارز:</dt>
                <dd class="col-sm-9">{{ performa.prf_currency_type }}</dd>

                <dt class="col-sm-3">نام فروشنده:</dt>
                <dd class="col-sm-9">{{ performa.prf_seller_name }}</dd>

                <dt class="col-sm-3">کشور فروشنده:</dt>
                <dd class="col-sm-9">{{ performa.prf_seller_country }}</dd>

                <dt class="col-sm-3">شماره سفارش:</dt>
                <dd class="col-sm-9">{{ performa.prf_order_no }}</dd>

                <dt class="col-sm-3">وضعیت:</dt>
                <dd class="col-sm-9">{{ performa.prf_status }}</dd>
            </dl>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            اطلاعات گمرکی و حمل و نقل
        </div>
        <div class="card-body">
            {% if details %}
                <table class="table table-bordered table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>کد جزئیات</th>
                            <th>گمرک مقصد</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for detail in details %}
                            <tr>
                                <td>{{ detail.prfctm_code }}</td>
                                <td>{{ detail.prfctm_name }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="alert alert-warning" role="alert">
                    هیچ جزئیاتی موجود نیست.
                </div>
            {% endif %}
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            اطلاعات مالی و بانکی
        </div>
        <div class="card-body">
            {% if performa.payments.all %}
                <table class="table table-bordered table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>تاریخ پرداخت</th>
                            <th>مبلغ</th>
                            <th>وضعیت</th>
                            <th>پرداخت‌کننده</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for payment in performa.payments.all %}
                            <tr>
                                <td>{{ payment.payment_date|date:"Y-m-d H:i" }}</td>
                                <td>{{ payment.payment_amount }}</td>
                                <td>{{ payment.payment_status|default:"-" }}</td>
                                <td>{{ payment.payer_name|default:"-" }}{% if payment.payer_email %} ({{ payment.payer_email }}){% endif %}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="alert alert-warning" role="alert">
                    هیچ پرداختی موجود نیست.
                </div>
            {% endif %}
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-warning text-white">
            کالا ها
        </div>
        <div class="card-body">
            {% if performa.request_statuses.all %}
                <table class="table table-bordered table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>کد وضعیت</th>
                            <th>HS کد کالا</th>
                            <th>شرح تجاری</th>
                            <th>وضعیت ارسال</th>
                            <th>وضعیت استعلام ضوابط</th>
                            <th>شرح مجوز</th>
                            <th>نام مجوز</th>
                            <th>کد مجوز</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for status in performa.request_statuses.all %}
                            <tr>
                                <td>{{ status.pfg_vcode_lng }}</td>
                                <td>{{ status.gds_hs_code }}</td>
                                <td>{{ status.pfg_commercial_desc_str }}</td>
                                <td>{{ status.pgp_send_status_tny }}</td>
                                <td>{{ status.pfg_status_criteria_inquiry|default:"-" }}</td>
                                <td>{{ status.pfg_status_result_request_sabtaresh|default:"-" }}</td>
                                <td>{{ status.agn_name_str }}</td>
                                <td>{{ status.agn_vcode_int }}</td>

                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="alert alert-warning" role="alert">
                    هیچ وضعیت درخواست ثبت نشده است.
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}
